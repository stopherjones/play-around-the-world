<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Around the World - List of games</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a href="index.html" class="back-link">Back to Gallery</a>
    <h1 class="main-title">List of games</h1>

    <div class="stat-display">
        <span id="statText">0 games in 0 of 0 countries</span>
    </div>

    <p class="subtitle">A complete list of games organized by country</p>
    <p class="subtitle">
        Games marked with an asterisk (*) do not have that country as a primary focus â€“
        see <a href="about.html">about</a> for more info.
    </p>

    <!-- Sticky Nav Bar -->
    <nav class="filter-bar">

        <div class="filter-group">
            <label for="searchInput">Search</label>
            <input type="text" id="searchInput" placeholder="Find a country...">
        </div>

        <div class="filter-group">
            <label for="continentFilter">Continent</label>
            <select id="continentFilter">
                <option value="all">All</option>
                <option value="Africa">Africa</option>
                <option value="Asia">Asia</option>
                <option value="Europe">Europe</option>
                <option value="North America">North America</option>
                <option value="South America">South America</option>
                <option value="Oceania">Oceania</option>
            </select>
        </div>
    </nav>

    <div class="container">
        <div id="gamesList" class="games-list"></div>
    </div>

    <script>
        let countriesData = [];

        fetch("countries.json")
            .then(res => res.json())
            .then(data => {
                countriesData = data;
                renderGames();
                updateStats(data);
            });

        function updateStats(data) {
            const totalGames = data.reduce((sum, c) => sum + (c.games ? c.games.length : 0), 0);
            const readCountries = data.filter(c => c.read).length;
            const totalCountries = data.filter(c => c.type === 'country').length;

            const statText = document.getElementById("statText");
            if (statText) {
                statText.textContent = `${totalGames} games in ${readCountries} of ${totalCountries} countries`;
            }
        }

        document.getElementById('searchInput').addEventListener('input', renderGames);
        document.getElementById('continentFilter').addEventListener('change', renderGames);

        function renderGames() {
            const gamesList = document.getElementById("gamesList");
            gamesList.innerHTML = "";

            const search = document.getElementById('searchInput').value.toLowerCase();
            const continent = document.getElementById('continentFilter').value;

            const filtered = countriesData.filter(c =>
                c.read &&
                c.games?.length > 0 &&
                (search === '' || c.name.toLowerCase().includes(search)) &&
                (continent === 'all' || c.continent === continent)
            );

            if (filtered.length === 0) {
                gamesList.innerHTML = '<div class="empty-state">No games recorded yet.</div>';
                return;
            }

            const countries = filtered.filter(c => c.type === 'country');
            const territories = filtered.filter(c => c.type === 'territory');

            function renderCountryGroup(country) {
                const block = document.createElement('div');
                block.classList.add('country-block');

                const heading = document.createElement('div');
                heading.classList.add('section-title');
                heading.textContent = country.name;
                block.appendChild(heading);

                country.games.forEach(game => {
                    const item = document.createElement("div");
                    item.classList.add("game-item");

                    const flagDiv = document.createElement("div");
                    flagDiv.classList.add("flag-thumbnail");

                    const img = document.createElement("img");
                    img.src = country.code.includes("/") || country.code.startsWith("http")
                        ? country.code
                        : `https://flagcdn.com/w640/${country.code}.png`;
                    img.alt = `Flag of ${country.name}`;
                    flagDiv.appendChild(img);

                    const details = document.createElement("div");
                    details.classList.add("game-details");

                    const title = document.createElement("div");
                    title.classList.add("game-title");

                    const titleWithoutBrackets = game.title.replace(/\s*\(.*?\)\s*/g, "");

                    const slug = titleWithoutBrackets.toLowerCase().replace(/[^a-z0-9]+/g, "");
                    const url = `https://boardgamearena.com/gamepanel?game=${slug}`;

                    title.innerHTML = `
                        <span class="title-text">${game.title}</span><br>
                        <a href="${url}" target="_blank" class="game-url">${url}</a>
                    `;
                    details.appendChild(title);

                    item.appendChild(flagDiv);
                    item.appendChild(details);
                    block.appendChild(item);
                });

                gamesList.appendChild(block);
            }

            function renderGroup(title, items) {
                if (items.length === 0) return;

                const label = document.createElement('div');
                label.classList.add('section-title');
                label.textContent = title;
                gamesList.appendChild(label);

                items.forEach(renderCountryGroup);
            }

            renderGroup("Countries", countries);
            renderGroup("Other regions and territories", territories);

            updateStats(countriesData);
        }
    </script>
</body>
</html>
